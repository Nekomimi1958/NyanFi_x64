<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
  <title>振り分けダイアログ</title>
  <link rel="stylesheet" type="text/css" href="help.css">
  <object type="application/x-oleobject" classid="clsid:1e2a7bd0-dab9-11d0-b93a-00c04fc99f9e">
    <param name="Keyword" value="Distribute.INI">
    <param name="Keyword" value="DistributionDlg">
    <param name="Keyword" value="リストファイル">
    <param name="Keyword" value="振り分けダイアログ">
    <param name="Keyword" value="正規表現">
  </object>
</head>

<body>
  <h1>振り分けダイアログ</h1>
  <p>
    ファイラーで <a href="hid00005.htm#DistributionDlg">DistributionDlg</a> コマンドを実行するとこのダイアログが開きます。<br>
    あらかじめ登録しておいた設定にしたがって、カレント側で選択中(無ければすべて)の項目を振り分けます(移動/コピー)。
  </p>

  <p>
    <b>タイトル</b>、<b>マスク/パターン</b>、<b>振り分け先</b>を設定し、<span class="btn_frame">登録</span>ボタンで登録してください(最大登録数200)。<br>
  </p>

  <p>
    <b>マスク/パターン</b> には、ワイルドカードを用いたマスクか、正規表現のマッチパターンを設定できます。<b>/</b> 〜 <b>/</b>
    で囲むと正規表現パターンとみなされます。その場合、入力内容が正しくないと背景色が変わり(<a href="hid00023.htm">オプション設定 - フォント・配色</a>
    「不正な入力項目の背景色」)、登録できません。なお、右クリックメニューで正規表現を参照できます。<br>
  </p>

  <dl>
    <dt class="no_bg">リストファイル</dt>
    <dd>
      多数の項目を登録したい場合、<b>リストファイル</b>で指定することもできます。<br>
      リストファイルは、<span class="format_text">マスク/パターン <span class="ctrl_text">[TAB]</span> 振り分け先</span>
      という書式で記述してください。行数に制限はありません。<br>
      リストファイルを作成したら、そのファイル名の頭に <b>@</b> を付けてマスク/パターン欄に入力してください(ドライブ名がない場合、<b>NyanFi</b> ディレクトリ相対)。<br>
      右端の<span class="btn_frame">...</span>ボタンでファイルを参照できます。入力したファイルが存在しないと背景色が変わって登録できません。<br>
      <b>リストファイルの例</b>　<small><span class="ctrl_text">[TAB]</span> はタブ文字、<span class="note_text">振り分け先の \\
          区切りに注意</span></small>
      <pre class="example_box margin1">
春*.txt<span class="ctrl_text">[TAB]</span>D:\\Data\\春
夏*.txt<span class="ctrl_text">[TAB]</span>D:\\Data\\夏
秋*.txt<span class="ctrl_text">[TAB]</span>D:\\Data\\秋
冬*.txt<span class="ctrl_text">[TAB]</span>D:\\Data\\冬
</pre>
    </dd>
  </dl>

  <p>
    <b>振り分け先</b> には、通常の文字列の他に、以下のように展開される書式文字列が使用できます。<b>\\</b>
    で区切れば、絶対指定や複数階層のディレクトリ指定も可能です。なお、これらの書式文字列は、右クリックメニューから参照できます。ドライブ名を含まない場合、反対パスからの相対指定になります。空欄の場合は、反対パスそのものになります。<span
      class="btn_frame">...</span>ボタンで参照したり、存在するディレクトリ名をクリップボードから貼り付けたりした場合、自動的に <b>\</b> が <b>\\</b> に置換されます。<br>
    <b>マスク/パターン</b> に<b>リストファイル</b>を指定している場合、<b>振り分け先</b>欄には入力できません。<br>
  </p>

  <table width="100%">
    <tr>
      <td width="180">　　<b>\L(</b>n<b>)</b></td>
      <td>ファイル名主部の左からn文字</td>
    </tr>
    <tr>
      <td>　　<b>\S(</b>m,n<b>)</b></td>
      <td>ファイル名主部のm番目からn文字</td>
    </tr>
    <tr>
      <td>　　<b>\R(</b>n<b>)</b></td>
      <td>ファイル名主部の右からn文字</td>
    </tr>
    <tr>
      <td>　　<b>\E</b></td>
      <td>拡張子( . は除く)</td>
    </tr>
    <tr>
      <td valign="top">　　<b>\TS(</b>日時書式<b>)</b></td>
      <td>タイムスタンプ<br>
        日時書式には以下の指定子が使えます。<br>
        yyyy 年(4桁)、yy 年(2桁)、mm 月(01〜12)、dd 日(01〜31)、hh 時(00〜23)、nn 分(00〜59)、ss 秒(00〜59)<br>
      </td>
    </tr>
    <tr>
      <td valign="top">　　<b>\XT(</b>日時書式<b>)</b></td>
      <td>Exif情報の撮影日時 (取得できなかった場合は空文字列になります)<br>
        日時書式は <b>\TS</b> と同じです。
        <br>
      </td>
    </tr>
    <tr>
      <td>　　<b>\1</b>、<b>\2</b>、…<b>\</b>n</td>
      <td>n番目の正規表現サブパターンのマッチ内容</td>
    </tr>
    <tr>
      <td>　　<b>\\</b></td>
      <td><b>\</b> そのもの(複数階層のディレクトリ区切りに使用)</td>
    </tr>
  </table>

  <p class="indent2">
    <b>例</b>: 撮影年によってJpeg画像を振り分け(絶対指定)<br>
    　<span class="inp_box">*.jpg</span> → <span class="inp_box">D:\\img\XT(yyyy)</span><br>
    　hogehoge.jpg → D:\img2016<br>
    <br>

    <b>例</b>: 名前の末尾が3桁数字のテキストファイルを100番ごとに振り分け(相対指定)<br>
    　<span class="inp_box">/(\d)\d{2}\.txt/</span> → <span class="inp_box">\E\100-\199</span><br>
    　hoge012.txt → txt000-099<br>
    　hoge345.txt → txt300-399<br>
    <br>
  </p>

  <p>
    登録内容を変更したい場合は、一覧の項目を選んで設定を変えてから<span class="btn_frame">変更</span>ボタンを押してください。<br>
    項目の削除は、<span class="btn_frame">削除</span>ボタンか<span class="btn_frame">DEL</span>キーで行ってください。<br>
    <span class="btn_frame">↑</span>/<span class="btn_frame">↓</span>ボタンで、項目を上下に移動できます。一覧にフォーカスがある場合は、 <span
      class="btn_frame">Shift</span>+<span class="btn_frame">Ctrl</span>+<span class="btn_frame">↑</span>/<span
      class="btn_frame">↓</span>キーでも移動可能。また、ドラッグ＆ドロップでも項目を移動できます(上下端で自動スクロール)。項目は上にあるほど優先順位が高く、マッチしたらそれより下の項目は無視されます。<br>
  </p>

  <p>
    一覧の右クリックメニューで「<b>リストファイルのプレビューを表示</b>」をチェックすると、右側にリストファイルのプレビューが表示されます。<br>
    また、「<b>リストファイルの編集</b>」を選ぶと、一覧で選択されているリストファイルをテキストエディタで開けます。一覧やリストファイルのプレビューにフォーカスがある場合は、ファイラーで <a
      href="hid00005.htm#FileEdit">FileEdit</a>、コマンドが割り当てられているキーでも開けます。
  </p>

  <p>
    一覧のチェックボックスで、登録した設定項目の有効/無効を切り替えられます。<span class="btn_frame">&#x2713;</span>ボタンを押すとすべてをチェック/クリアできます。<br>
    また、右クリックメニューの「<b>同一タイトルを同時に設定</b>」がチェックされていると、一覧のチェックボックスの状態を変更したときに、それと同じタイトルの項目の状態も同時に変更されます。<br>
    下の一覧には、マッチしている項目とその振り分け先がプレビュー表示されます。プレビュー一覧のヘッダをクリックすると、ソート方法を切り替えられます(ファイル名/振り分け先)。
  </p>

  <p>
    <b>検索</b> <img src="edit.png" alt=""> 欄に文字列を入力すると、タイトル、マスク/パターン、振り分け先のいずれかにそれが含まれる項目が選択状態になります。その後、<span
      class="btn_frame">∨</span>、<span class="btn_frame">∧</span>ボタンで上方向/下方向に検索できます。<br>
    また、プレビュー一覧の項目をダブルクリックすると、そのマッチ条件となった登録項目が上の一覧で選択されます。
  </p>

  <p>
    必要に応じ<b>同名時の処理</b>を設定し、<span class="btn_frame">コピー</span>または<span class="btn_frame">移動</span>ボタンを押してください。<br>
    <img src="chkbox.png" alt=""> <b>振り分け先を自動作成</b>
    がチェックされていると、振り分け先のディレクトリが存在しない場合、コピー/移動の前に自動作成されます。チェックを外すと、振り分け先が存在しないコピー/移動はスキップします。その場合、プレビュー一覧で振り分け先をエラー色で表示、ステータスバーにスキップ数を表示、またログには警告を出します。<br>
    振り分け先がカレントと同じになる場合も、スキップしてログに警告を出します。<br>
    なお、すべてがスキップされる場合は、実行を開始できません。<br>
    振り分け処理は、バックグラウンドのタスクで行われます。<a href="hid00074.htm">同期コピー</a>は働きません。
  </p>

  <p>
    <a href="hid00005.htm#DistributionDlg">DistributionDlg</a> コマンドのパラメータに <b>XC</b> または <b>XM</b>
    を指定していると、あらかじめダイアログで設定されている内容にしたがって、確認を行わずに直ちに振り分けコピーまたは移動を実行します。<br>
    これを利用して、<a href="hid00021.htm">イベント</a>や<a href="hid00075.htm">.nyanfi ファイル</a>を設定すれば、特定の条件で自動的に振り分けるような動作も可能です。
  </p>

  <dl>
    <dt class="no_bg" id="DistributeINI">振り分け登録ファイル</dt>
    <dd>
      振り分け登録内容は、デフォルトではINIファイルで管理され、ダイアログを閉じたときに更新されます。二重起動した <b>NyanFi</b>
      では、その時点でのINIファイルから登録内容を取得しますが、登録内容の変更はできません。<br>
      右クリックメニューの「<b>振り分け登録ファイルを作成</b>」でファイルを作成しておくと、INIファイルの代わりにこのファイルで登録内容が管理され、二重起動した <b>NyanFi</b>
      でも登録内容の変更が可能になります。デフォルトのファイル名は <b>Distribute.INI</b>
      ですが別の名前にしてもかまいません。複数の登録ファイルがある場合、「<b>振り分け登録ファイルの選択</b>」で切り替えられます。また、<a
        href="hid00005.htm#DistributionDlg">DistributionDlg</a> コマンドのパラメータに登録ファイル名を指定することもできます。<br>
      ダイアログのタイトルバーには、どのファイルで管理されているかが表示されます。<br>
      使用中の登録ファイルを削除すると、INIファイルによる管理に戻ります。
    </dd>
  </dl>
  <br><br>

</body>

</html>